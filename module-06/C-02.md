# Next.js এ searchParams - সম্পূর্ণ গাইড

`searchParams` হল Next.js 13+ (App Router) এর একটি feature যা URL এর query parameters handle করতে ব্যবহৃত হয়।

## দুই ধরনের Router System

Next.js এ দুইটি routing system আছে:

- **Pages Router** (পুরাতন) - `useRouter` ব্যবহার করে
- **App Router** (নতুন) - `searchParams` ব্যবহার করে

## searchParams কি?

URL এর `?` চিহ্নের পরের অংশকে query parameters বলে। যেমন:

```
https://example.com/products?category=electronics&sort=price&page=2
                              ↑
                              এই অংশ হল query parameters
```

এখানে:

- `category=electronics`
- `sort=price`
- `page=2`

## Server Components এ searchParams

### Basic Usage

```typescript
// app/products/page.tsx
export default function ProductsPage({
  searchParams,
}: {
  searchParams: { [key: string]: string | string[] | undefined }
}) {
  // URL: /products?category=electronics&sort=price

  console.log(searchParams.category) // 'electronics'
  console.log(searchParams.sort)     // 'price'

  return (
    <div>
      <h1>Category: {searchParams.category}</h1>
      <p>Sort by: {searchParams.sort}</p>
    </div>
  )
}
```

### Multiple Values (Array)

একই parameter এ একাধিক value:

```typescript
// URL: /products?color=red&color=blue&color=green

export default function ProductsPage({
  searchParams,
}: {
  searchParams: { [key: string]: string | string[] | undefined }
}) {
  const colors = searchParams.color

  // colors হতে পারে: 'red' (single) অথবা ['red', 'blue', 'green'] (array)

  if (Array.isArray(colors)) {
    return <p>Selected colors: {colors.join(', ')}</p>
  }

  return <p>Selected color: {colors}</p>
}
```

### Practical Example - Product Filter

```typescript
// app/products/page.tsx
type SearchParams = {
  category?: string
  minPrice?: string
  maxPrice?: string
  sort?: string
  page?: string
}

export default function ProductsPage({
  searchParams,
}: {
  searchParams: SearchParams
}) {
  // Default values set করা
  const category = searchParams.category || 'all'
  const minPrice = Number(searchParams.minPrice) || 0
  const maxPrice = Number(searchParams.maxPrice) || 10000
  const sort = searchParams.sort || 'newest'
  const page = Number(searchParams.page) || 1

  // Database query করা (এটা server-side এ হবে)
  const products = fetchProducts({
    category,
    minPrice,
    maxPrice,
    sort,
    page,
  })

  return (
    <div>
      <h1>Products - {category}</h1>
      <p>Showing page {page}</p>
      <p>Price range: ${minPrice} - ${maxPrice}</p>

      <ProductList products={products} />
    </div>
  )
}
```

## Client Components এ searchParams

Client components এ সরাসরি `searchParams` পাওয়া যায় না। এর জন্য `useSearchParams` hook ব্যবহার করতে হয়।

### useSearchParams Hook

```typescript
'use client'

import { useSearchParams } from 'next/navigation'

export default function FilterComponent() {
  const searchParams = useSearchParams()

  // Individual parameter পাওয়া
  const category = searchParams.get('category')
  const sort = searchParams.get('sort')

  // সব parameters পাওয়া
  const allParams = searchParams.toString()
  // Output: "category=electronics&sort=price"

  // Check করা parameter আছে কিনা
  const hasCategory = searchParams.has('category')

  return (
    <div>
      <p>Category: {category}</p>
      <p>Sort: {sort}</p>
      <p>Has category filter: {hasCategory ? 'Yes' : 'No'}</p>
    </div>
  )
}
```

### URL Update করা (Client-side)

```typescript
'use client'

import { useSearchParams, useRouter, usePathname } from 'next/navigation'

export default function FilterForm() {
  const router = useRouter()
  const pathname = usePathname()
  const searchParams = useSearchParams()

  const updateFilter = (key: string, value: string) => {
    // Current params থেকে নতুন URLSearchParams তৈরি
    const params = new URLSearchParams(searchParams.toString())

    // নতুন value set করা
    params.set(key, value)

    // URL update করা
    router.push(`${pathname}?${params.toString()}`)
  }

  const removeFilter = (key: string) => {
    const params = new URLSearchParams(searchParams.toString())
    params.delete(key)
    router.push(`${pathname}?${params.toString()}`)
  }

  return (
    <div>
      <button onClick={() => updateFilter('category', 'electronics')}>
        Electronics
      </button>

      <button onClick={() => updateFilter('sort', 'price')}>
        Sort by Price
      </button>

      <button onClick={() => removeFilter('category')}>
        Clear Category
      </button>
    </div>
  )
}
```

## Complete Example - E-commerce Filter System

### Server Component (Page)

```typescript
// app/products/page.tsx
import FilterSidebar from './FilterSidebar'
import ProductGrid from './ProductGrid'

type SearchParams = {
  category?: string
  brand?: string
  minPrice?: string
  maxPrice?: string
  sort?: string
  search?: string
}

export default async function ProductsPage({
  searchParams,
}: {
  searchParams: SearchParams
}) {
  // Filters extract করা
  const filters = {
    category: searchParams.category,
    brand: searchParams.brand,
    minPrice: searchParams.minPrice ? Number(searchParams.minPrice) : undefined,
    maxPrice: searchParams.maxPrice ? Number(searchParams.maxPrice) : undefined,
    search: searchParams.search,
  }

  const sortBy = searchParams.sort || 'newest'

  // Server-side data fetch
  const products = await fetchProducts(filters, sortBy)

  return (
    <div className="container">
      <FilterSidebar currentFilters={filters} />
      <ProductGrid products={products} sortBy={sortBy} />
    </div>
  )
}
```

### Client Component (Filter)

```typescript
// app/products/FilterSidebar.tsx
'use client'

import { useSearchParams, useRouter, usePathname } from 'next/navigation'
import { useState } from 'react'

export default function FilterSidebar({ currentFilters }: any) {
  const router = useRouter()
  const pathname = usePathname()
  const searchParams = useSearchParams()

  const [minPrice, setMinPrice] = useState(currentFilters.minPrice || '')
  const [maxPrice, setMaxPrice] = useState(currentFilters.maxPrice || '')

  const updateParams = (updates: Record<string, string>) => {
    const params = new URLSearchParams(searchParams.toString())

    // Updates apply করা
    Object.entries(updates).forEach(([key, value]) => {
      if (value) {
        params.set(key, value)
      } else {
        params.delete(key)
      }
    })

    router.push(`${pathname}?${params.toString()}`)
  }

  const applyPriceFilter = () => {
    updateParams({
      minPrice: minPrice,
      maxPrice: maxPrice,
    })
  }

  const clearAllFilters = () => {
    router.push(pathname)
  }

  return (
    <div className="filter-sidebar">
      {/* Category Filter */}
      <div>
        <h3>Category</h3>
        <button onClick={() => updateParams({ category: 'electronics' })}>
          Electronics
        </button>
        <button onClick={() => updateParams({ category: 'clothing' })}>
          Clothing
        </button>
      </div>

      {/* Price Filter */}
      <div>
        <h3>Price Range</h3>
        <input
          type="number"
          placeholder="Min"
          value={minPrice}
          onChange={(e) => setMinPrice(e.target.value)}
        />
        <input
          type="number"
          placeholder="Max"
          value={maxPrice}
          onChange={(e) => setMaxPrice(e.target.value)}
        />
        <button onClick={applyPriceFilter}>Apply</button>
      </div>

      {/* Sort */}
      <div>
        <h3>Sort By</h3>
        <select
          value={searchParams.get('sort') || 'newest'}
          onChange={(e) => updateParams({ sort: e.target.value })}
        >
          <option value="newest">Newest</option>
          <option value="price-low">Price: Low to High</option>
          <option value="price-high">Price: High to Low</option>
        </select>
      </div>

      <button onClick={clearAllFilters}>Clear All Filters</button>
    </div>
  )
}
```

## গুরুত্বপূর্ণ বিষয়

### 1. Type Safety

```typescript
// সঠিক type definition
type SearchParams = {
  id?: string;
  page?: string;
  // কখনো number লিখবেন না, সবসময় string
};
```

### 2. URL Parameters সবসময় String

```typescript
// ভুল ❌
const page: number = searchParams.page;

// সঠিক ✅
const page = Number(searchParams.page) || 1;
```

### 3. Undefined Check

```typescript
// সবসময় default value দিন
const category = searchParams.category || "all";
const page = searchParams.page ? Number(searchParams.page) : 1;
```

### 4. Multiple Values Handle

```typescript
const tags = searchParams.tags;

if (Array.isArray(tags)) {
  // Multiple values: ['tag1', 'tag2']
} else if (tags) {
  // Single value: 'tag1'
} else {
  // No value
}
```

## Pages Router vs App Router

### Pages Router (পুরাতন পদ্ধতি)

```typescript
import { useRouter } from "next/router";

function Page() {
  const router = useRouter();
  const { category, sort } = router.query;
}
```

### App Router (নতুন পদ্ধতি)

```typescript
// Server Component
function Page({ searchParams }: { searchParams: any }) {
  const { category, sort } = searchParams;
}

// Client Component
("use client");
import { useSearchParams } from "next/navigation";

function Component() {
  const searchParams = useSearchParams();
  const category = searchParams.get("category");
}
```

## Best Practices

1. **Server Components এ যতটা সম্ভব logic রাখুন** - Better performance
2. **Type safety নিশ্চিত করুন** - TypeScript ব্যবহার করুন
3. **Default values সেট করুন** - Undefined errors এড়াতে
4. **URL কে single source of truth বানান** - State management সহজ হয়
5. **Debounce করুন search input এ** - অতিরিক্ত navigation এড়াতে
