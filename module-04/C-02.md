Next.js-এর **Server Components** এবং **Server Actions**-এ কুকি (Cookie) কীভাবে কাজ করে, তা বোঝা অত্যন্ত জরুরি।

## ১. Server Components-এ কুকি ব্যবহারের নিয়ম

সার্ভার কম্পোনেন্টে কুকি নিয়ে কাজ করার সময় মনে রাখতে হবে যে, কুকি মূলত ব্রাউজারে (Client-side) জমা থাকে।

- **কুকি রিড করা (Reading):** সার্ভার কম্পোনেন্টে আপনি সহজেই কুকি পড়তে পারেন। কারণ, যখনই কোনো ব্রাউজার সার্ভারের কাছে রিকোয়েস্ট পাঠায়, সে তার সাথে কুকিগুলোকেও **HTTP Request Header**-এর মাধ্যমে পাঠিয়ে দেয়। সার্ভার সেই হেডার থেকে ডেটা সংগ্রহ করে আপনাকে দেখায়।
- **কুকি সেট করা (Setting/Modifying):** আপনি সরাসরি একটি সাধারণ Server Component-এর ভেতরে `cookies().set()` বা `.delete()` করতে পারবেন না।
- **কারণ:** সার্ভার কম্পোনেন্ট শুধু HTML জেনারেট করে। কিন্তু কুকি সেভ করার জন্য ব্রাউজারকে একটি বিশেষ ইনস্ট্রাকশন (`Set-Cookie` header) পাঠাতে হয়। এই ইনস্ট্রাকশন পাঠানোর ক্ষমতা শুধু **Server Actions** অথবা **Route Handlers**-এর আছে।

- Server Components-এ কুকি ব্যবহারের নিয়ম

  সার্ভার কম্পোনেন্টে কুকি মূলত **Read-only** হিসেবে কাজ করে।
  **উদাহরণ:** ধরুন, ইউজারের থিম (Dark/Light) কুকিতে সেভ করা আছে। সেটি আমরা সার্ভার কম্পোনেন্টে দেখাব।

```javascript
// app/dashboard/page.js (Server Component)
import { cookies } from "next/headers";

export default function Dashboard() {
  const cookieStore = cookies();
  const theme = cookieStore.get("theme"); // কুকি রিড করা হচ্ছে

  return (
    <div>
      <h1>ইউজারের বর্তমান থিম: {theme?.value || "Default Light"}</h1>
    </div>
  );
}
```

## ২. Server Actions-এ কুকি ব্যবহারের প্রভাব

যখন আপনি কোনো **Server Action**-এর মাধ্যমে কুকি সেট বা ডিলিট করেন, তখন Next.js পর্দার আড়ালে কিছু কাজ করে:

- **Automatic Re-rendering:** কুকি পরিবর্তন হওয়ার সাথে সাথে Next.js বর্তমান পেজ এবং তার লেআউটগুলোকে সার্ভারে পুনরায় রেন্ডার (Re-render) করে। এর ফলে আপনার ইউজার ইন্টারফেস (UI) তৎক্ষণাৎ নতুন কুকি ভ্যালু অনুযায়ী আপডেট হয়ে যায়।
- **UI State Preservation:** কুকি পরিবর্তনের কারণে পেজটি রি-রেন্ডার হলেও এটি সম্পূর্ণ 'Refresh' বা 'Unmount' হয় না। অর্থাৎ, ক্লায়েন্ট সাইডের স্টেট (যেমন ইনপুট ফিল্ডের লেখা) হারায় না, কিন্তু সার্ভার থেকে আসা ডেটার ওপর নির্ভরশীল ইফেক্টগুলো পুনরায় রান হয়।
- **Data Refreshing:** আপনি যদি চান কুকি পরিবর্তনের পাশাপাশি ক্যাশ (Cache) করা ডেটাও আপডেট হোক, তবে অ্যাকশনের ভেতরে `revalidatePath()` বা `revalidateTag()` কল করা প্রয়োজন।

Server Actions-এ কুকি ব্যবহারের প্রভাব

Server Actions মূলত POST রিকোয়েস্টের মতো কাজ করে। এখানে কুকি সেট, আপডেট বা ডিলিট করা যায়।

**উদাহরণ:** ইউজার লগইন করলে একটি 'session' টোকেন সেট করা এবং লগআউট করলে তা ডিলিট করা।

```javascript
// app/actions.js (Server Action)
"use server";

import { cookies } from "next/headers";

export async function handleLogin(formData) {
  // কুকি সেট করা
  cookies().set("session", "user-token-123", { httpOnly: true });
}

export async function handleLogout() {
  // কুকি ডিলিট করা
  cookies().delete("session");
}
```

### সংক্ষেপে মনে রাখার টিপস:

| অ্যাকশন                | Server Component             | Server Action / Route Handler   |
| ---------------------- | ---------------------------- | ------------------------------- |
| **Read (পড়া)**         | ✅ সম্ভব (`cookies().get()`) | ✅ সম্ভব                        |
| **Write (সেট করা)**    | ❌ অসম্ভব                    | ✅ সম্ভব (`cookies().set()`)    |
| **Delete (মুছে ফেলা)** | ❌ অসম্ভব                    | ✅ সম্ভব (`cookies().delete()`) |
